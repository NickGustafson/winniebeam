<!DOCTYPE html>
<html lang="en-CA">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Diary Pages</title>
		<script>
			var pages = null;
			var mos = [ "january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december" ];

			function jumpToDate(str)
			{
				document.location.href = "#" + str;
			}

			Date.prototype.DateFormat = function(formatString)
			{
				var months = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ];
				var yyyy = this.getFullYear();
				var yy = yyyy.toString().substring(2);
				var m = this.getMonth();
				var mm = m < 10 ? "0" + m : m;
				var mmm = months[m];
				var d = this.getDate();
				var dd = d < 10 ? "0" + d : d;
				
				var h = this.getHours();
				var hh = h < 10 ? "0" + h : h;
				var n = this.getMinutes();
				var nn = n < 10 ? "0" + n : n;
				var s = this.getSeconds();
				var ss = s < 10 ? "0" + s : s;

				formatString = formatString.replace(/yyyy/, yyyy);
				formatString = formatString.replace(/yy/, yy);
				formatString = formatString.replace(/mmm/, mmm);
				formatString = formatString.replace(/mm/, mm);
				formatString = formatString.replace(/dd/, dd);
				formatString = formatString.replace(/d/, d);
				formatString = formatString.replace(/hh/, hh);
				formatString = formatString.replace(/nn/, nn);
				formatString = formatString.replace(/ss/, ss);

				return formatString;
			}

			window.onload = function()
			{
				var xhttp = new XMLHttpRequest();
				xhttp.onload = function()
				{
					if(this.status == 404) 
					{
						alert("That is not a valid file.  Please try again.");
						return;
					}
					if(this.status == 200 && this.responseText != null) 
					{				
						pages = JSON.parse(this.responseText);
						var d, para, h2;
						for(var p in pages)
						{
							h2 = document.createElement("h2");
							h2.innerHTML = (new Date(p + "T00:00")).DateFormat("mmm d, yyyy");

							para = document.createElement("p");
							para.innerHTML = pages[p]; 

							d = document.createElement("div");
							d.id = p;
							d.appendChild(h2);
							d.appendChild(para);
							document.querySelector("#output div").appendChild(d);
						}
					}
				};
				xhttp.open("GET", "full_text.json?rand=" + (new Date()).getTime(), true);
				xhttp.send();	
			};

			function doSearch(param)
			{
				var esc = param.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
				var re = new RegExp(esc, "gi");

				var list = document.querySelector("#sidebar ol");
				list.innerHTML = "";

				var li, a, page;
				for(var p in pages)
				{
					page = document.querySelector("[id='" + p + "'] p");
					page.innerHTML = page.innerText;
					
					if(pages[p].toLowerCase().indexOf(param.toLowerCase()) != -1)
					{
						a = document.createElement("a");
						a.href = "#" + p;
						a.innerHTML = (new Date(p + "T00:00")).DateFormat("mmm d, yyyy");

						li = document.createElement("li");
						li.appendChild(a);
						list.appendChild(li);
						
						page.innerHTML = page.innerHTML.replace(re, "<mark>" + param + "</mark>");
					}
				}
				list.previousElementSibling.innerHTML = list.childNodes.length + " results for \"" + param + "\".";
			}
		</script>
		<link href="https://fonts.googleapis.com/css?family=Old+Standard+TT" rel="stylesheet" />
		<style>
			body { font-family: 'Old Standard TT', serif;height:100%;width:100%;margin:0;padding:0;background-color:#ead4ae;font-size:16pt; }

			header 
			{ 
				background-image:url('images/diary_bkgrd.png');
				background-repeat:no-repeat;
				background-size:cover;
				background-position:center 80%;
				
				text-shadow: 3px 3px 3px #F2D5A4;
				box-shadow:2px 2px 2px #000000; 

				margin-left:17%;
				margin-bottom:20px;

				width:60%;
			}

			header h1 { margin:0 10px;padding-top:20px }
			header h1 span { font-size:2em; }
			header h2 { margin:-10px 10px 0 10px;font-size:1em;padding-bottom:20px; }
			sup { font-size:smaller; }

			#sidebar, #output { display:inline-block;vertical-align:top; }

			#sidebar { width:15%;height:99%;position:fixed;overflow:auto;font-size:12pt;font-family:Arial;padding:10px;background-color:#ffffff; }
			#sidebar span { display:block;font-weight:bold;font-size:14pt;margin:10px 0; }
			
			#output { margin-left:17%;width:60%; }
			#output h2 { font-size:22pt;margin:5px 0;padding:5px 0;border-top:solid 2px red;border-bottom:solid 2px red; }

			label { font-weight:bold;display:inline-block;margin-right:5px; }
		</style>
	</head>
	<body>
		<nav id="sidebar">
			<label>Search</label><input type="search" /><button type="button" onclick="doSearch(this.previousSibling.value)">Go</button>
			<span></span>
			<ol></ol>
		</nav>

		<header>
			<h1>The Diary of<br /><span>Winnie Beam</span></h1>
			<h2>An Archive of Early 20<sup>th</sup> Century St. Catharines</h2>
		</header>

		<section id="output">
			<label>Jump to Date:</label>
			<input id="diaryDate" type="date" value="1900-01-01" max="1901-01-31" min="1900-01-01" onchange="jumpToDate(this.value)" title="Select date" />
			<div></div>
		</section>
	</body>
</html>